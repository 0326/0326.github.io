title: 从JavaScript的严格模式说起
date: 2015-04-11
tags: 译文
category: blog
photos: http://7xp4vm.com1.z0.glb.clouddn.com/Pylons_Project___Home.png-q55
---

JavaScript的严格模式(strict mode)可以让代码更安全严谨的运行.使用严格模式(use strict),有以下优点:
- 消除Javascript语法的一些不合理、不严谨之处，减少一些怪异行为;
- 消除代码运行的一些不安全之处，保证代码运行的安全；
- 提高编译器效率，增加运行速度；
- 为未来新版本的Javascript做好铺垫。
但是,本文并不会介绍[use strict的详细用法](http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html),之所以会有严格模式,其实就是为了给JavaScript"屎一样的设计"擦屁股,所以本文真正想讨论的是JavaScript这门语言本身.
<!-- more -->

如果你有看[use strict的详细用法](http://www.ruanyifeng.com/blog/2013/01/javascript_strict_mode.html),你肯定会觉得严格模式真棒,有这么多好处!如果你有看过<<JavaScript语言精粹>>(JavaScript: The Good Parts),你肯定会觉得这本书写的真好,以后就这样写JS啦!但是反过来一想,strict mode和the good parts要解决的问题都是让程序员能够更严谨,更合理,更安全的去写JS,这说明JS本身的语言设计就有很多不合理的地方.


### 源头
其实作为一个前端,我一开始并未觉得JS是一门很烂得语言,只是觉得它很奇葩,不过写着写着也就习惯了,其"糟粕部分"也基本上在代码中看不见了,相反,其"精华"部分得以放大,所以最终在生产中并未很关注语言本身带来的影响,而所谓的糟粕也并不是影响生产力的关键因素.只是最近和几个后台程序员交流,他们力喷JS是屎一样的语言,作为一名前端,本想反驳,可是后来想一想,如果是从纯语言的角度去看,我竟无法反驳...,但是,若从一个工具的角度来说,JS的确是一把利剑.

好吧,为了充分的证明JS是一门*一样的语言,我决定从源头开始分析,顺便也把其他语言拿过来对比一下:

#### JS的诞生
Brendan Eich,就是下面这货,在10天内赶出了JavaScript:
<img src="http://image20.it168.com/201403_0x0/1781/3811caeaf58d75ae.jpg"/>
首先Brendan Eich的大神地位毋庸置疑,10天对于普通程序员一个小项目可能都上线不了,更别说开发一门新的语言了.但是能开发一门广为流传的语言的人,必定都是大神级别的,所以,JS在这点上与C,Java相比并无优势.

JS是在Java诞生后不久出现的,Eich本人其实很鄙视Java,有关JS诞生的更多细节,可以[戳这里](http://www.ruanyifeng.com/blog/2011/06/birth_of_javascript.html).
哦,对了,大神开发这门语言的初衷是给"非专业编程人员和设计师"用的.

#### C的诞生
Ｃ语言是贝尔实验室于70年代初研制出来的，后来又被多次改进，并出现了多种版本。之后的改进和扩充就不讲了,毕竟JS以及其他语言诞生之后都会有所改进,这是下文了.仅从诞生背景,C语言就高大上了一截啊,再加上其流行度和影响力...算了,还是介绍下一个吧...

#### Java的诞生
首先,Java是James Gosling等人,也就是说不是一个人,在1990年初开发完成的.一开始不叫Java,叫Oak,后来在1995年正式发布.也就是说Java的诞生至少经过了一批工程师,经过了5年时间才诞生的.

#### Ruby的诞生
JS是动态语言,或许找个相同类别的语言应该更有可比性.Ruby也是一个人写出来的,这点跟JS一样.但是Ruby得开发动机跟JS完全不同,作者本人对面向对象和脚本语言很感兴趣,于是去玩了Perl和Python,但是觉得并不爽,于是就自己写了一个,他要设计一个比Perl更强大,比Python更面向对象的语言,这就是是Ruby诞生的初衷.最终经过一年多的时间,Ruby诞生了...

#### Python的诞生
python也是一个人写出来的,这点跟JS/Ruby都是一样的,不过Python受C影响很大,作者花了2年才写出来的.我想用过Python的人都应该知道那首Python小诗,Python最初的设计原则就是简洁优美,虽然我并不知道发展到Python3之后成了啥样子...


好了,应该不用再举例子了,看完这几种语言,我越发觉得Eich牛逼了,别人都搞了好几年,他10天就撸出来了.所以,从纯语言的角度来说,JS确实是一门很搓的语言.这也是为什么有这么多程序员都鄙视JavaScript程序员.虽然大家都鄙视PHP程序员.

### 影响力
JS的影响力是毋庸置疑,谁也不会想到他会风靡如此之快.虽然不及C和Java深远,但是编程史上排前10是绝对没问题的.那么,JS有着如此影响力是真的是这门语言很牛逼,还是只是因为它是风口浪尖上得猪而已?

哈哈,这个问题还真不好答.

首先做一个假设,假如当年Eich不是开发出了JS,而是开发出了像Python,Perl这种脚本语言,那这门语言还会不会像现在这样影响深远?
如果是得话,那JS毫无疑问是是屎一眼的语言.


### 语言特性
每一门语言其实都有自己的特点,就跟人一样.你虽然特别看不惯某人但这并不代表着此人是坨屎,说不定他看你也是一样的.我们应该看到他人之优点并将其发扬光大,扬长避短,一样能出奇制胜.

每一门语言都会有人吐槽的,只是JS的特别多,以道格拉斯大神的JavaScript: The Good Parts为例.其中"糟粕"部分也就是被吐槽的部分,下面一一列举,看这些值得吐槽的部分到底是在语言中占据了举足轻重的作用还是根本不值一提.
首先,大神觉得大部分编程语言都有精华部分和shit,初学者往往以自己能使用某一语言的所有特性来装逼,而大神则只使用其中的精华部分.JavaScript中的shit特别多,让大神吃了一惊.

#### 槽点1:全局变量
大神觉得这是最糟糕的部分.全局变量会让程序变的难以调试,尤其是在大型Web应用中.
然而解决这个问题并不难,我们其实可以有效的规避全局变量,而事实上包括严格模式和一系列编码规范也对全局变量做了限制,因此我并不觉的这是一个很影响coding的问题.

#### 槽点2:作用域
这确实是个大BUG,有块级语法却没有块级作用域,让人很是费解(而为了规避这个问题引发的不良后果,程序员们又制定了相应的编码规范).当年刚学JavaScript的时候看到这里就懵逼了,学完后自认为又习得了一项新技能.但是现在想想,了解了一门语言中的一个缺陷设定,并没有什么值得高兴的地方.
好在,ES6中引入了块级作用域,因此这个槽点,也即将成为历史了.

#### 槽点3:自动插入分号
JS有个自动插入分号的机制(ASI),让你的代码可以不在句末写分号也能运行.针对这个问题,业界已引发了一系列口水战并且分为三派:加分号派喷不加分号派
,不加分号派喷加分号派,然后加分号派和不加分号派一起喷可加可不加分号派.
最终,业界大神们都认为这是风格问题.并且你会看到不少优秀的开源项目也都没加分号.
我个人觉得,这的确是JavaScript的一个设计缺陷,如果要加就像C一样强制加,如果不加就像Python一样干脆彻底一点.搞个ASI确实蛋疼.

#### 槽点4:保留字
JS中确实有一些没有用上的保留字,但我并不认为这是一个设计缺陷.应该是作者考虑到语言之后的拓展而采取的一种策略,毕竟不管你用哪种语言,都会有保留字,多几个少几个并不算是问题.

#### 槽点5: Unicode
JS使用的是UCS-2字符集,这导致了所有字符在JS中都是2个字节的,4字节的字符会被当做2个字符来处理.为此,ES6还新增了一系列处理4字节编码的方法来擦屁股.
但是,这真的不能怪作者,因为JS诞生的时候,还没有UTF-16.了解更多请看[unicode和JavaScript](http://www.ruanyifeng.com/blog/2014/12/unicode.html)

#### 槽点6: typeof/new/void/contine/switch/with/NaN等关键字
使用typeof来判断对象类型确实会有问题,但是这个问题也是可以有效规避的,并无大碍.
如果在构造函数前面忘记使用new,this会被绑定到全局,后果会很严重,这个问题只能靠规范避免,而不能在语言层面解决.
void在其他语言中是一种类型,然而在JS中却是一个运算符,而且作用并不大,被大神认为是鸡肋.
大神说continue会影响性能,不知道其他语言是不是,解决方法就是不要使用continue.这的确很伤感.
说实话,switch穿透完全可以避免,在使用switch之前请务必研究一下JS的switch,避免不必要的麻烦.
with会影响效率,属于鸡肋型,公司里面的代码从未见到过,简直太没存在感了....
NaN用来表示非数字,其实理解NaN也很简单,关键是从语言设计的角度来看,搞个NaN是否真有必要.


#### 槽点7: parseInt/hasOwnProperty/eval等方法
JS里面有些方法不可按常理揣测,比如"20" > "100" 是对的,parseInt("20 kg")和parseInt("20")结果是一样的.而对于eval,大可学习它并远离它,其实这些槽点作为方法上得不完善,对整个JS语言的影响微乎其微.

#### 槽点8: +/==/++/--/位运算符等
+运算符虽然也被大神加入了黑名单,但我觉得这是一个很强大的功能,并且提高了JS的灵活性.而==虽然不推荐使用,但是在某些只需判断值无需判定类型的情况下却提供了便利.至于自增和自减运算符,完全是作者个人观点,并且这在其他语言也是很常见的语法.所以这点并不算是JS得槽点,要说也得是所有语言的槽点.

位运算符的设定就是个鸡肋,这点不能更同意了.在Java中,位运算符处理的是整数,速度那是相当的快.而JS中是木有整数类型的,只有双精度浮点型,所以在执行位运算的时候JS会先将其转化为整数,然后运算,最后再转回去.可想而知这效率...

列举了这么多槽点,其实还可以更多,但这已足够说明JS最初的设计有一部分很糟糕.仔细想想,之所以会这样,最大的原因就是工期太赶,只有10天,并且发布之后迅速得以扩展流行,连让Eich来优化的机会都不给.如果当时给Eich一年多的时间,JS肯定不会像现在这样(至少unicode的问题会得以解决).

所以,从语法特性的角度来看,JS依然有着相当搓的设定.

#### 槽点9: 性能问题
可以说这是最大的问题,也是脚本语言的通病.直到V8的出现让JS打了场漂亮的翻身仗,然而这并不是终点,对性能的极致追求最终又会引发一场新的革命,wasm已经按捺不住了.

### 缺陷背后

看到这里,估计大部分人,尤其是非前端的,已然成为JS黑,这么多槽点,跟别人扯淡的时候随口就能说上一两个爽一把.熟不知,这些槽点并不能阻止JS成为一门很强大的语言.就如同某些人一样,虽然患有先天残疾,但你却无法阻止他成为一名伟大的物理学家,你永远无法理解他对宇宙的认知有多么深刻.

稍微动下脑子也知道,如果JS真的搓的一逼,那为何还会如此流行,此时仿佛一个声音从身后大呼:"那是因为Web的流行,JS碰巧搭上了这条船罢了!"

好吧,如果要继续写下去,那么我得首先驳倒这个观点.



### 尽管JS设计的很糟,但它依然是一门强大的语言


参考
- JS:the good parts
- [http://www.ruanyifeng.com/blog/2011/06/10_design_defects_in_javascript.html](http://www.ruanyifeng.com/blog/2011/06/10_design_defects_in_javascript.html)
- [编程语言那么多，为什么Google偏爱JS？](http://www.leiphone.com/news/201509/7AqJKSY2yTWv95n6.html)
- [Javascript诞生记](http://www.ruanyifeng.com/blog/2011/06/birth_of_javascript.html)
- [http://brendaneich.github.io/ModernWeb.tw-2015/](http://brendaneich.github.io/ModernWeb.tw-2015/)


















